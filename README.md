# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## В данном проекте выбран паттерн MVP 

- слой данных - храненеие и изменение данных 
- слой представления - вывод данных на страницу
- презентер отвечает за взаимодействие данных и представления src/index.ts

## Диаграмма классов

![alt text](<Диаграмма классов.png>)


## Базовые классы

#  Класс api

Данный класс предназначен для отправки и получения запрососов.

 constructor(baseUrl: string, options: RequestInit = {})

В конструктор передается базовый адрес URL  сервера, по которому будут вешаться запросы и опции для этих запросов 

Поля: 

- baseURL - базовый адрес сервера 
- options - объект с заголовками запроса

Методы:

- handleResponse - принимает ответ от сервера как параметр, и обрабатывает его,возвращая результат в формате json или отклоненный промис с возникшей ошибкой
- _request - выполняет запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- get - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис который при разрешении содержит объект, которым ответил сервер или ошибку.
- post - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется 'POST' запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.


# Класс EventEmitter

В данном классе реализован брокер событий, который реализует паттерн "Наблюдатель" позволяющий отправлять события и подписываться на событиия, происходящие в системе. Класс используется для связи слоя данных и представления. 

constructor() - инициализирует брокер событий

Поля:

_events - Map, состоящий из ивентов и подписчиков
Методы:

on - подписка на событие
off - отписка от события
emit - инициализация события
onAll - подписка одновременно на все события
offAll - сброс ВСЕХ обработчиков
trigger - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

# Класс Component<T>

Абстрактный базовый класс, предназначенный для создания компонентов пользовательского интерфейса. Класс предоставляет инструменты для управления DOM элементами и поведением компонента.


Методы:

- toggleClass - переключается класс для переданного элемента
- setText - устанавливает текстовое содержимое для переданного элемента
- setImage - устанавливает изображения и альтернативный текст для изоображения(опционально) для переданного элемента типа HTMLImageElement
- setDisabled - изменяет статус блокировки для переданного элемента
- setHidden, setVisible - скрывает, отображает переданный элемент
- render - рендерит компонент, используя переданные данные. Метод должен быть переназначен в дочерних классах


# Класс View<T>
Базовый класс, расширяющий класс Component, добавляя в него поле events, в которое записывается брокер событий, для их генерации.

constructor(protected readonly events: IEvents, container: HTMLElement) - принимает элемент контейнера, в который будет помещен компонент и брокер событий

Методы: полностью наследуются от класса Component<T>


## Компоненты модели данных 

# Класс AppData

Отвечает за логику работы с данными и их хранение. Содержит набор методов для контролирования общего процесса работы приложения. 
Конструктор данного класса принимает брокер событий. 

Поля: 

- items - массив товар
- preview - открытый товар в данный момент
- basket - объект корзины, количество товара в ней и их сумма
- order - объект заказа
- formErors - ошибки формы

Методы: 

- addToBasket - метода добавления товара в корзину и инициализация события 'basket:change'
- removeFromBasket - метод удаления товара из корзины и иницилизация события 'basket:change'
- clearBasket - метод для очистки корзины и инициализация события 'basket:change'
- setItems - меняет массив товаров на переданный и инициализирует событие 'items:change'
- setPreview - меняет превью на переданный товар и инициализирует событие 'preview:change'
- clearBasket - очищает корзину и эмитит событие 'basket:change'
- setPaymentMethod - меняет способ оплаты на переданный 
- setOrderField - меняет содержимое переданного поля на полученное значение
- validateOrder - проверяет корректность заполнения формы
- clearOrder - очищает объект заказа

# Класс WebLarekApi 

Специальный компонент для взаимодействия с API магазина: получение списка товара(ов), оформление заказа.

Наследуется от базового класса api, реализует интерфейс IWebLarekApi




## Компоненнты модели отображения 


# Класс Modal 

Основной задачей класса является реализация модального окна. Данный класс предоставляет методы для управления состоянием модального окна, также отвечает за генерацию событий (modal:open), (modal:close).

Поля класса: 

- _closeButton - кнопка закрытия модального окна
- _content - элемент содержимого модального окна 


Сеттеры: 

- set(content) - отвечает за смену содержимого модального окна

Методы класса:

- open - метод открытия модального окна инициализация события 'modal:open'
- close - метод закрытия модального окна инициализация события 'modal:close'
- render - метод отвечающий за рендер модального окна


# Класс Form

Реализует общий компонент формы. Содержит базовые методы и сеттеры для работы с элементами отображения формы. В данном классе инициализируются события при инпуте и сабмите. 

Конструктор данного класса должен принимать брокер события и контейнер с формой. 

Поля: 

- _submit - элемент кнопки для подтверждения формы
- _errors - контейнер содержащий сообщение об ошибке 


Сеттеры:

- valid - отвечает за отключение кнопки 
- erors - меняет содержжимое компнента с ошибками формы

Методы: 

- onInputChange - метод инициализирует событие изменения инпута
- render  - метод рендерит компонент формы 


# Класс Page

Реализует главную страницу - каталог товаров с счетчиком. Содержит набор сеттеров, отвечающих за DOM-элементы главной страницы. 
Также генерирует событие 'basket:open' при клике на кнопку корзины.
Конструктор класса принимает брокер событий и DOM элемент

Поля:

- _counter - элемент счетчика на странице
- _catalog - элемент каталога на странице
- _wrapper - элемент обертки на странице
- _basket - элемент корзины на странице

Сеттеры:

counter - изменяет содержимое счетчика на полученное
catalog - изменяет содержмое каталога на полученные элементы
locked - изменяет класс обертки на значение, соответствующее переданному

# Класс Сard

Реализует карточку товара. Данный класс используется на главной странице, в модальном окне и в корзине. 
Наследуется от класса от абстрактного класса Component.

Поля: 

- _title - элемент заголовка карточки 
- _image - элемент картинки карточки
- _price - элемент цены карточки 
- _category - элемент товара карточки 
- _description - элемент описания товара 
- _button - кнопка добавления товара в коризну

Сеттеры: 

- id - принимает и задает id карточки
- title - меняет содержимое заголовка на полученное
- price - меняет содержимое контейнера с ценой на полученное
- category - меняет содержимое контейнера с категорией на полученное
- image - меняет изображение и альтернативный текст в карточке
- description - меняет содержимое контейнера с описанием на полученное
- button - устанавливает текст на кнопке


# Класс Basket 

Наследуется от класса View, реализует корзину. Конструктор данного класса принимает брокер событий и DOM элемент. 

Поля: 

- _template  - шаблон корзины
- _list - элемент списка товаров в корзине 
- _total - элемент суммы товаров в корзине
- _button - элемент кнопки оформления заказа

Методы:

- toggleButton - меняет состояние активности кнопки на переданное


Сеттеры:

- items - меняет содержимое в корзине в зависимости от переданных товаров
- total - меняет значение в элементе суммы товаров на переданное

# Класс Order

Наследуется от класса Form реализует компнонет формы отправки заказа. 
Конструктор данного класса принимает брокер событий и DOM элемент. 

Поля: 

- _paymentCard
- _paymentCash

Сеттеры:

payment - изменяет классы кнопок в зависимости от переданного типа оплаты
address - изменяет содержимое поля address в форме

# Класс Contacts

Класс наследуется от класса Form реализует компонент формы контактов. 
Конструктор данного класса должен принимать контейнер с формой и брокер событий. 

Поля: 

- _email - инпут для ввода email
- _phone - инпут для ввода телефона

Сеттеры: 

email - меняет содержимое поля email в форме
phone - меняет содержимое поля phone в форме


# Класс Success

Реализует окно с подтверждением заказа.

Принимает DOM-элемент окна на базе шаблона, брокер событий и объект с колбэком для вызова при нажатии кнопки в окне происходит закрытие окна.

Поля:

_close - элемент кнопки закрытия окна
_total - элемент с суммой заказа
Сеттеры:

total - меняет содержимое элемента с суммой заказа


## Презентер 

Отвечает за взаимодействие компонентов, находится в файле index.ts. 
Все взаимодействия происходят за счет брокера событий, который их отслеживает.



## Основные интерфейсы / типы

- IProduct интерфейс со всеми свойствами продукта 
- IBasket интерфейс корзины с содержиммым и тотал стоимостью товаров
- IBasketView интерфейс корзины для отображения на странице
- IOrder интерфес заказа для отправки на сервер 
- OrderForm - тип формы заказа 
- IOrderResult - интерфейс результата отправки заказа 


## Cобытия изменения данных (геенерация из модели данных)


- items:change - изменеие массива товаров
- preview:change - изменение товара в открываемом окне 
- basket:change - изменение товаров в корзине 
- formErrors:change - изменение в списке ошибок валидации формы


## События интерфейса 

- modal:open - открытие модального окна
- modal:close - закрытие модального окна
- basket:open - открытие модального окна корзины
- order:open - открытие окна оформления заказа
- form:submit - отправка формы 
- form:change - изменеие поля формы 